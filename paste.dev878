<?php
set_time_limit(0);
$extensions = ['php'];
$patterns = [
    'base64_decode',
    'eval(',
    'gzinflate',
    'gzuncompress',
    'str_rot13',
    'shell_exec',
    'passthru',
    'exec',
    'system',
    'popen',
    'proc_open',
    'file_put_contents',
    'file_get_contents',
    'fopen',
    'unlink',
    '?0=dxhere', 
    'wp_create_user', 
    'curl_exec', 
];


function scan_dir($dir, $extensions, $patterns) {
    $files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir));
    foreach ($files as $file) {
        if ($file->isFile()) {
            $ext = pathinfo($file->getFilename(), PATHINFO_EXTENSION);
            if (in_array(strtolower($ext), $extensions)) {
                $content = file_get_contents($file->getRealPath());
                foreach ($patterns as $pattern) {
                    if (stripos($content, $pattern) !== false) {
                        echo "[!] MENCURIGAKAN: " . $file->getRealPath() . " --> mengandung '" . $pattern . "'<br>";
                        break;
                    }
                }
                
                if (time() - filemtime($file->getRealPath()) < 30*24*60*60) {
                    echo "[*] File baru/diubah <30 hari: " . $file->getRealPath() . "<br>";
                }
            }
        }
    }
}


$start_dir = __DIR__; // scan dari folder ini
echo "<h3>Scan folder: $start_dir</h3>";
scan_dir($start_dir, $extensions, $patterns);

echo "<br>Scan selesai!";
?>

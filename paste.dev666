<?php
/*
Plugin Name: Emergency Admin Creator (temporary)
Description: Buat user admin sementara. Hapus file setelah user berhasil dibuat.
Version: 1.0
Author: You
*/

if ( defined( 'WP_INSTALLING' ) && WP_INSTALLING ) {
    return;
}

add_action( 'init', function() {
    // ========== GANTI INI SEBELUM DIUPLOAD ==========
    $username = 'emergency_admin';
    $email    = 'admin@example.com';
    $password = 'Str0ngP@ssw0rd!'; // pakai password kuat, minimal 12 karakter
    // ===============================================

    if ( empty( $username ) || empty( $email ) || empty( $password ) ) {
        return;
    }

    // Jika user sudah ada, hentikan
    if ( username_exists( $username ) || email_exists( $email ) ) {
        return;
    }

    require_once ABSPATH . 'wp-includes/pluggable.php';

    $user_id = wp_create_user( $username, $password, $email );
    if ( is_wp_error( $user_id ) ) {
        error_log( 'Emergency admin creation failed: ' . $user_id->get_error_message() );
        return;
    }

    $user = new WP_User( $user_id );
    $user->set_role( 'administrator' );

    // Tulis ke log supaya kamu tahu dibuat
    error_log( sprintf( 'Emergency admin created: %s (%d)', $username, $user_id ) );

    // Jangan jalankan lagi setelah dibuat â€” tambahkan transient
    set_transient( 'emergency_admin_created_' . md5( $username . $email ), 1, DAY_IN_SECONDS );
}, 5 );

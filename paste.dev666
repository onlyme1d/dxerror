<?php


$path = __DIR__; // direktori saat ini
$log_file = __DIR__ . "/file_changes.log";
$time_limit = time() - 3600; // cek file yang diubah 1 jam terakhir

$rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path));

$changes = [];
foreach ($rii as $file) {
    if ($file->isDir()) continue;

    $mtime = $file->getMTime();
    $ctime = $file->getCTime();

    if ($mtime >= $time_limit || $ctime >= $time_limit) {
        $changes[] = [
            'file' => $file->getPathname(),
            'modified' => date("Y-m-d H:i:s", $mtime),
            'created' => date("Y-m-d H:i:s", $ctime)
        ];
    }
}


if (!empty($changes)) {
    $fp = fopen($log_file, "a");
    foreach ($changes as $c) {
        fwrite($fp, "[ " . date("Y-m-d H:i:s") . " ] " . $c['file'] . " | Modified: " . $c['modified'] . " | Created: " . $c['created'] . "\n");
    }
    fclose($fp);
}

header("Content-Type: text/plain");
echo "File changes in last 1 hour:\n\n";
foreach ($changes as $c) {
    echo $c['file'] . " | Modified: " . $c['modified'] . " | Created: " . $c['created'] . "\n";
}
